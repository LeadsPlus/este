<!doctype html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
  <title>este.storage.Local</title>
  <link href='/assets/js/este/demos/css/default.css' rel='stylesheet'>
  <script src='/assets/js/dev/livereload.js'></script>
  <script src='/assets/js/google-closure/closure/goog/base.js'></script>
  <script src='/assets/js/deps.js'></script>
  <script>
    goog.require('este.dev.Monitor.create')
    goog.require('este.storage.Local')
    goog.require('este.Model')
  </script>
</head>
<body>
  <h1>este.storage.Local</h1>
  <fieldset>
    <label>Text:<br>
    <input id='text' autofucus type='text'>
    </label>
    <br>
    <button id='add'>add</button>
    <ul id='items'></ul>
    <hr>
    <button id='reload'>reload</button>
    <button id='delete-reload'>delete then reload</button>
  </fieldset>
  <textarea style='width: 20em; height: 10em' id='code'></textarea>
  <script>
    este.dev.Monitor.create()

    var storage = new este.storage.Local('storage-demo')
    var input = document.getElementById('text')
    var addButton = document.getElementById('add')

    var showSerializedLocalStorage = function() {
      var serializedStorage = JSON.stringify(window.localStorage)
      document.getElementById('code').value = serializedStorage
    }

    var showSerializedModels = function() {
      var html = ''
      document.getElementById('items').innerHTML = html
    }

    showSerializedLocalStorage()
    showSerializedModels()

    addButton.onclick = function() {
      if (!input.value)
        return

      addButton.disabled = true
      var model = new este.Model({'text': input.value})
      var result = storage.save(model)

      goog.result.waitOnSuccess(result, function(id) {
        showSerializedLocalStorage()
        input.value = ''
        addButton.disabled = false
      })
    }

    document.getElementById('reload').onclick = function() {
      location.reload()
    }

    document.getElementById('delete-reload').onclick = function() {
      storage.delete(model)
      location.reload()
    }

  </script>
</body>